<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notepad+++ PWA</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* –®–ê–ü–ö–ê */
        .header {
            background: #2d2d30;
            padding: 15px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .logo {
            font-weight: bold;
            font-size: 1.2em;
            color: #569cd6;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* –ü–ê–ù–ï–õ–¨ –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í */
        .toolbar {
            background: #252526;
            padding: 10px 15px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            border-bottom: 1px solid #3e3e42;
            flex-shrink: 0;
        }
        
        .toolbar-btn {
            background: #3e3e42;
            color: #d4d4d4;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
        }
        
        .toolbar-btn:hover, .toolbar-btn:active {
            background: #4a4a4f;
        }
        
        /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* –°–ê–ô–î–ë–ê–† –° –§–ê–ô–õ–ê–ú–ò */
        .sidebar {
            width: 250px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }
        
        .file-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .file-item {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .file-item:hover {
            background: #2a2d2e;
        }
        
        .file-item.active {
            background: #094771;
        }
        
        .file-name {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-extension {
            color: #9cdcfe;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        /* –û–ë–õ–ê–°–¢–¨ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø */
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .filename-input {
            background: #252526;
            border: none;
            color: #d4d4d4;
            padding: 15px;
            font-size: 16px;
            border-bottom: 1px solid #3e3e42;
            width: 100%;
            flex-shrink: 0;
        }
        
        .filename-input:focus {
            outline: none;
            background: #2a2d2e;
        }
        
        .editor {
            flex: 1;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 20px;
            font-family: 'SF Mono', 'Cascadia Code', 'Consolas', monospace;
            font-size: 15px;
            line-height: 1.6;
            resize: none;
            overflow-y: auto;
            tab-size: 4;
            white-space: pre;
        }
        
        .editor:focus {
            outline: none;
        }
        
        /* –°–¢–ê–¢–£–° –ë–ê–† */
        .status-bar {
            background: #007acc;
            color: white;
            padding: 8px 15px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            flex-shrink: 0;
        }
        
        /* –í–°–ü–õ–´–í–ê–Æ–©–ò–ï –û–ö–ù–ê */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal {
            background: #252526;
            border-radius: 8px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            border: 1px solid #3e3e42;
        }
        
        .modal h3 {
            margin-bottom: 15px;
            color: #569cd6;
        }
        
        .modal-input {
            width: 100%;
            padding: 12px;
            background: #3e3e42;
            border: 1px solid #5a5a5a;
            border-radius: 4px;
            color: #d4d4d4;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .modal-input:focus {
            outline: none;
            border-color: #007acc;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .modal-btn.primary {
            background: #007acc;
            color: white;
        }
        
        .modal-btn.secondary {
            background: #3e3e42;
            color: #d4d4d4;
        }
        
        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .toolbar {
                overflow-x: auto;
            }
            
            .logo span {
                display: none;
            }
        }
        
        @media (max-width: 576px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                bottom: 0;
                z-index: 100;
                transition: left 0.3s;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .mobile-toggle {
                display: block !important;
            }
        }
        
        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: #d4d4d4;
            font-size: 20px;
            cursor: pointer;
        }
        
        .file-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .file-item:hover .file-actions {
            opacity: 1;
        }
        
        .file-action-btn {
            background: none;
            border: none;
            color: #858585;
            font-size: 14px;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
        }
        
        .file-action-btn:hover {
            background: #3e3e42;
            color: #d4d4d4;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –®–ê–ü–ö–ê -->
        <div class="header">
            <button class="mobile-toggle" id="toggleSidebar">‚ò∞</button>
            <div class="logo">
                <span>üìù</span>
                <span>Notepad+++</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="toolbar-btn" id="saveBtn">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
        
        <!-- –ü–ê–ù–ï–õ–¨ –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í -->
        <div class="toolbar">
            <button class="toolbar-btn" id="newFileBtn">
                üìÑ –ù–æ–≤—ã–π —Ñ–∞–π–ª
            </button>
            <button class="toolbar-btn" id="uploadBtn">
                üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
            </button>
            <button class="toolbar-btn" id="downloadBtn">
                ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
            </button>
            <button class="toolbar-btn" id="renameBtn">
                ‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å
            </button>
            <button class="toolbar-btn" id="deleteBtn">
                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
            </button>
            <input type="file" id="fileUpload" accept=".txt,.js,.html,.css,.json,.md,.xml,.py,.java,.c,.cpp,.csv,.log,.env,.conf,.config,.wpddc" style="display: none;">
        </div>
        
        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
        <div class="main-content">
            <!-- –°–ê–ô–î–ë–ê–† -->
            <div class="sidebar" id="sidebar">
                <div class="file-list" id="fileList">
                    <!-- –§–∞–π–ª—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                <div style="padding: 15px; border-top: 1px solid #3e3e42;">
                    <div style="color: #858585; font-size: 12px; margin-bottom: 10px;">
                        üìÅ –§–∞–π–ª—ã –≤ –ø–∞–º—è—Ç–∏: <span id="fileCount">0</span>
                    </div>
                    <div style="color: #858585; font-size: 11px; line-height: 1.4;">
                        –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ñ–∞–π–ª—ã —Å –ª—é–±—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏: .txt, .js, .html, .wpddc –∏ –¥—Ä.
                    </div>
                </div>
            </div>
            
            <!-- –û–ë–õ–ê–°–¢–¨ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
            <div class="editor-area">
                <input type="text" class="filename-input" id="filenameInput" placeholder="filename.ext" value="–Ω–æ–≤—ã–π_—Ñ–∞–π–ª.txt">
                <textarea class="editor" id="editor" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–µ—á–∞—Ç–∞—Ç—å –∑–¥–µ—Å—å..."></textarea>
            </div>
        </div>
        
        <!-- –°–¢–ê–¢–£–° –ë–ê–† -->
        <div class="status-bar">
            <span id="statusText">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</span>
            <span id="charCount">0 —Å–∏–º–≤–æ–ª–æ–≤</span>
        </div>
    </div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ù–û–í–û–ì–û –§–ê–ô–õ–ê -->
    <div class="modal-overlay" id="newFileModal">
        <div class="modal">
            <h3>üìÑ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª</h3>
            <input type="text" class="modal-input" id="newFileName" placeholder="filename.ext" value="–Ω–æ–≤—ã–π_—Ñ–∞–π–ª.txt">
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelNewBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" id="createFileBtn">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–Ø -->
    <div class="modal-overlay" id="renameModal">
        <div class="modal">
            <h3>‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª</h3>
            <input type="text" class="modal-input" id="renameInput" placeholder="–Ω–æ–≤–æ–µ_–∏–º—è.ext">
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelRenameBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" id="renameFileBtn">–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // =================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===================
        let files = JSON.parse(localStorage.getItem('notepad_files')) || [];
        let currentFileId = null;
        
        // =================== –≠–õ–ï–ú–ï–ù–¢–´ DOM ===================
        const editor = document.getElementById('editor');
        const filenameInput = document.getElementById('filenameInput');
        const fileList = document.getElementById('fileList');
        const fileCount = document.getElementById('fileCount');
        const statusText = document.getElementById('statusText');
        const charCount = document.getElementById('charCount');
        
        // –ö–Ω–æ–ø–∫–∏
        const newFileBtn = document.getElementById('newFileBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const renameBtn = document.getElementById('renameBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const saveBtn = document.getElementById('saveBtn');
        const fileUpload = document.getElementById('fileUpload');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const sidebar = document.getElementById('sidebar');
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        const newFileModal = document.getElementById('newFileModal');
        const newFileName = document.getElementById('newFileName');
        const createFileBtn = document.getElementById('createFileBtn');
        const cancelNewBtn = document.getElementById('cancelNewBtn');
        
        const renameModal = document.getElementById('renameModal');
        const renameInput = document.getElementById('renameInput');
        const renameFileBtn = document.getElementById('renameFileBtn');
        const cancelRenameBtn = document.getElementById('cancelRenameBtn');
        
        // =================== –§–£–ù–ö–¶–ò–ò ===================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            updateFileList();
            if (files.length > 0) {
                loadFile(files[0].id);
            } else {
                createNewFile('–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ.txt', '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ Notepad+++ –¥–ª—è iPhone.\n\n–í—ã –º–æ–∂–µ—Ç–µ:\n‚Ä¢ –°–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã —Å –ª—é–±—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏\n‚Ä¢ –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞\n‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç\n‚Ä¢ –°–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã –æ–±—Ä–∞—Ç–Ω–æ\n\n–ù–∞—á–Ω–∏—Ç–µ —Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞!');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
        function updateFileList() {
            fileList.innerHTML = '';
            files.forEach(file => {
                const div = document.createElement('div');
                div.className = `file-item ${currentFileId === file.id ? 'active' : ''}`;
                div.innerHTML = `
                    <div class="file-name">
                        <span>üìÑ</span>
                        <span>${file.name}</span>
                        <span class="file-extension">${getExtension(file.name)}</span>
                    </div>
                    <div class="file-actions">
                        <button class="file-action-btn" onclick="deleteFile('${file.id}', event)">üóëÔ∏è</button>
                    </div>
                `;
                div.onclick = () => loadFile(file.id);
                fileList.appendChild(div);
            });
            fileCount.textContent = files.length;
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function getExtension(filename) {
            return filename.includes('.') ? filename.split('.').pop() : '';
        }
        
        // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª
        function createNewFile(name = '–Ω–æ–≤—ã–π_—Ñ–∞–π–ª.txt', content = '') {
            const id = Date.now().toString();
            const file = {
                id,
                name,
                content,
                created: new Date().toISOString(),
                modified: new Date().toISOString()
            };
            files.push(file);
            saveToStorage();
            updateFileList();
            loadFile(id);
            showStatus(`–§–∞–π–ª "${name}" —Å–æ–∑–¥–∞–Ω`);
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
        function loadFile(id) {
            const file = files.find(f => f.id === id);
            if (file) {
                currentFileId = id;
                editor.value = file.content;
                filenameInput.value = file.name;
                updateFileList();
                updateCharCount();
                showStatus(`–§–∞–π–ª "${file.name}" –∑–∞–≥—Ä—É–∂–µ–Ω`);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª
        function saveCurrentFile() {
            if (!currentFileId) return;
            const file = files.find(f => f.id === currentFileId);
            if (file) {
                file.content = editor.value;
                file.name = filenameInput.value;
                file.modified = new Date().toISOString();
                saveToStorage();
                updateFileList();
                showStatus(`–§–∞–π–ª "${file.name}" —Å–æ—Ö—Ä–∞–Ω—ë–Ω`);
            }
        }
        
        // –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª
        function deleteFile(id, event = null) {
            if (event) event.stopPropagation();
            
            const file = files.find(f => f.id === id);
            if (!file) return;
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª "${file.name}"?`)) {
                files = files.filter(f => f.id !== id);
                saveToStorage();
                
                if (currentFileId === id) {
                    if (files.length > 0) {
                        loadFile(files[0].id);
                    } else {
                        currentFileId = null;
                        editor.value = '';
                        filenameInput.value = '';
                    }
                }
                
                updateFileList();
                showStatus(`–§–∞–π–ª "${file.name}" —É–¥–∞–ª—ë–Ω`);
            }
        }
        
        // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª
        function renameCurrentFile() {
            if (!currentFileId) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }
            
            const file = files.find(f => f.id === currentFileId);
            renameInput.value = file.name;
            renameModal.style.display = 'flex';
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function uploadFile() {
            fileUpload.click();
        }
        
        // –°–∫–∞—á–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª
        function downloadCurrentFile() {
            if (!currentFileId) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }
            
            const file = files.find(f => f.id === currentFileId);
            const blob = new Blob([file.content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus(`–§–∞–π–ª "${file.name}" —Å–∫–∞—á–∞–Ω`);
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        function saveToStorage() {
            localStorage.setItem('notepad_files', JSON.stringify(files));
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(text) {
            statusText.textContent = text;
            setTimeout(() => {
                if (statusText.textContent === text) {
                    statusText.textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
                }
            }, 3000);
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
        function updateCharCount() {
            const count = editor.value.length;
            charCount.textContent = `${count} —Å–∏–º–≤–æ–ª–æ–≤`;
        }
        
        // =================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ===================
        
        // –†–µ–¥–∞–∫—Ç–æ—Ä
        editor.addEventListener('input', () => {
            updateCharCount();
        });
        
        // –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        filenameInput.addEventListener('change', saveCurrentFile);
        
        // –ö–Ω–æ–ø–∫–∏ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        newFileBtn.addEventListener('click', () => {
            newFileName.value = '–Ω–æ–≤—ã–π_—Ñ–∞–π–ª.txt';
            newFileModal.style.display = 'flex';
            newFileName.focus();
        });
        
        uploadBtn.addEventListener('click', uploadFile);
        downloadBtn.addEventListener('click', downloadCurrentFile);
        renameBtn.addEventListener('click', renameCurrentFile);
        deleteBtn.addEventListener('click', () => {
            if (currentFileId) deleteFile(currentFileId);
        });
        saveBtn.addEventListener('click', saveCurrentFile);
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        fileUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                createNewFile(file.name, e.target.result);
            };
            reader.readAsText(file);
            fileUpload.value = '';
        });
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
        createFileBtn.addEventListener('click', () => {
            const name = newFileName.value.trim() || '–Ω–æ–≤—ã–π_—Ñ–∞–π–ª.txt';
            createNewFile(name, '');
            newFileModal.style.display = 'none';
        });
        
        cancelNewBtn.addEventListener('click', () => {
            newFileModal.style.display = 'none';
        });
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
        renameFileBtn.addEventListener('click', () => {
            const newName = renameInput.value.trim();
            if (newName && currentFileId) {
                const file = files.find(f => f.id === currentFileId);
                file.name = newName;
                filenameInput.value = newName;
                saveToStorage();
                updateFileList();
                renameModal.style.display = 'none';
                showStatus(`–§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ "${newName}"`);
            }
        });
        
        cancelRenameBtn.addEventListener('click', () => {
            renameModal.style.display = 'none';
        });
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
        [newFileModal, renameModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        editor.addEventListener('blur', saveCurrentFile);
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ (–µ—Å–ª–∏ –Ω–∞ –ü–ö)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveCurrentFile();
                        break;
                    case 'n':
                        e.preventDefault();
                        newFileBtn.click();
                        break;
                    case 'o':
                        e.preventDefault();
                        uploadBtn.click();
                        break;
                }
            }
        });
        
        // =================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===================
        init();
        
        // Service Worker –¥–ª—è PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(() => console.log('SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
                .catch(err => console.log('–û—à–∏–±–∫–∞ SW:', err));
        }
    </script>
</body>
</html>
